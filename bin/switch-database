#!/bin/bash

# Helper script to switch between SQLite and PostgreSQL

if [ "$#" -ne 1 ]; then
    echo "Usage: ./bin/switch-database [sqlite|postgresql]"
    exit 1
fi

DATABASE=$1
ENV_FILE=".env.local"

if [ ! -f "$ENV_FILE" ]; then
    touch "$ENV_FILE"
fi

case $DATABASE in
    sqlite)
        echo "Switching to SQLite..."
        if grep -q "^DATABASE_URL=" "$ENV_FILE"; then
            sed -i '' 's|^DATABASE_URL=.*|DATABASE_URL=${SQLITE_DATABASE_URL}|' "$ENV_FILE"
        else
            echo "DATABASE_URL=\${SQLITE_DATABASE_URL}" >> "$ENV_FILE"
        fi
        echo "✓ Database switched to SQLite"
        echo "  Run 'task restart' to apply changes"
        ;;
    postgresql|postgres|pgsql)
        echo "Switching to PostgreSQL..."
        if grep -q "^DATABASE_URL=" "$ENV_FILE"; then
            sed -i '' 's|^DATABASE_URL=.*|DATABASE_URL=${POSTGRES_DATABASE_URL}|' "$ENV_FILE"
        else
            echo "DATABASE_URL=\${POSTGRES_DATABASE_URL}" >> "$ENV_FILE"
        fi
        echo "✓ Database switched to PostgreSQL"
        echo "  Run 'task restart' to apply changes"
        ;;
    *)
        echo "Error: Invalid database type '$DATABASE'"
        echo "Valid options: sqlite, postgresql"
        exit 1
        ;;
esac
